---
layout: post
title: "PGWN - 15 janvier 2007"
author: "SAS"
categories: [PostgreSQL Weekly News]
redirect_from: "index.php?post/drupal/231"
---


<p><strong>

Les mises à jours 8.2.1, 8.1.6, 8.0.10, 7.4.15 et 7.3.17 sont désormais disponibles.</strong> Les paquetages existent pour Debian, Fedora, Fink, FreeBSD, Red Hat et Ubuntu. Ne tardez pas à faire les mises à jour.

</p>

<p><strong>Les nouveautés des produits dérivés</strong></p>

<ul>

<li>

Another PostgreSQL Diff Tool 1.0.0_beta13&nbsp;:

<a target="_blank" href="http://pgfoundry.org/projects/apgdiff/">http://pgfoundry.org/projects/apgdiff/</a>

</li>

<li>

pfm 1.4.3&nbsp;:

<a target="_blank" href="http://pgfoundry.org/projects/pfm/">http://pgfoundry.org/projects/pfm/</a>

</li>

<li>

mysql2pgsql-1.0.2&nbsp;:

<a target="_blank" href="http://gborg.postgresql.org/project/mysql2psql/projdisplay.php">http://gborg.postgresql.org/project/mysql2psql/projdisplay.php</a>

</li>

<li>

PostgreSQL SDBC Driver 0.7.3&nbsp;:

<a target="_blank" href="http://dba.openoffice.org/drivers/postgresql/">http://dba.openoffice.org/drivers/postgresql/</a>

</li>

<li>

Navicat PostgreSQL 7.2.10 pour Windows&nbsp;:

<a target="_blank" href="http://pgsql.navicat.com/">http://pgsql.navicat.com/</a>

</li>

<li>

Slony-I 1.2.6&nbsp;:

<a target="_blank" href="http://slony.info/">http://slony.info/</a>

</li>

<li>

audittrail2-beta1&nbsp;:

<a target="_blank" href="http://pgfoundry.org/projects/audittrail2/">http://pgfoundry.org/projects/audittrail2/</a>

</li>

<li>

PGCluster 1.5.0rc13 et 1.7.0rc2&nbsp;:

<a target="_blank" href="http://pgfoundry.org/projects/pgcluster/">http://pgfoundry.org/projects/pgcluster/</a>

</li>

</ul>

<!--more-->


<p><strong>PostgreSQL Local</strong></p>

<p>

Le German PostgreSQL Usergroup (Groupe Allemand d'Utilisateurs <a target="_blank" href="http://www.pgug.de">http://www.pgug.de</a>) crée trois nouveaux prospectus en anglais et en allemand. Les sujets en sont&nbsp;:

</p>

<ul>

<li>un résumé de PG&nbsp;;</li>

<li>PG et la réplication&nbsp;;</li>

<li>PG et les SGBD concurrents.</li>

</ul>

Pour participer, contacter info at pgug dot de.

<p>

N'oubliez pas de soumettre vos propositions pour PGCon 2007. Cet évènement se déroulera à Ottawa, Ontario, Canada. Dernière limite pour les propositions, le 19 janvier.

<a target="_blank" href="http://www.pgcon.org/2007/submissions.php">http://www.pgcon.org/2007/submissions.php</a>

</p>

<p>

Il y aura un stand PostgreSQL lors du FOSDEM les 24 et 25 février à Bruxelles, Belgique. La plupart des célébrités de la communauté PostgreSQL de l'UE y sera. Contacter de@postgresql.org pour participer. <a target="_blank" href="http://www.fosdem.org/2007/">http://www.fosdem.org/2007/</a>

</p>

<p>

Pavel Stehule assure un cours sur les procédures stockées sous PostgreSQL, le 11 janvier 2007 à Pragues. Cours en tchèque. Trop tard pour y participer.

<a target="_blank" href="http://www.root.cz/zpravicky/skoleni-o-ulozenych-procedurach-v-postgresql/">http://www.root.cz/zpravicky/skoleni-o-ulozenych-procedurach-v-postgresql/</a>

</p>

<p>

La communauté italienne de PostgreSQL organise une journée PostgreSQL cet été. Marquez ce lien pour participer.

<a target="_blank" href="http://www.pgday.it">http://www.pgday.it</a>

</p>

<p>

Gavin Sherry tient une miniconf PostgreSQL lors de Linux.Conf.Au à Sydney mardi 16 janvier 2007.

<a target="_blank" href="http://lca2007.linux.org.au/Miniconfs/PostgreSQL">http://lca2007.linux.org.au/Miniconfs/PostgreSQL</a>

Il est trop tard pour y être ;-)

</p>

<p><strong>PostgreSQL dans les média</strong></p>

<ul>

<li>

Planet PostgreSQL&nbsp;:<br />

<a target="_blank" href="http://www.planetpostgresql.org/">http://www.planetpostgresql.org/</a>

</li>

<li>

General Bits, Archives et articles occasionnels&nbsp;:<br />

<a target="_blank" href="http://www.varlena.com/GeneralBits/">http://www.varlena.com/GeneralBits/</a>

</li>

</ul>

<p><em>

PostgreSQL Weekly News vous est présenté cette semaine par David Fetter, Devrim GUNDUZ et Robert Treat.

Adaptation francophone de Stéphane Schildknecht. </em></p>

<p>

Pour voir vos propositions incluses dans le prochain numéro, envoyez les avant lundi 0h00 à david at fetter dot org</p>

<p><strong>Correctifs appliqués</strong></p>

<p>

Alvaro Herrera a commité&nbsp;: </p>

<ul><li>

le correctif de Marko Kreen qui remplace les define DISABLE_ZLIB inutiles de pgcrypto par HAVE_LIBZ du core&nbsp;;</li>

<li>

le correctif d'autovacuum qui évite de laisser des Xids non permanents dans les bases qui n'acceptent pas de connexion. Appliqué uniquement à la branche 8.1 car 8.2 (et HEAD) n'ont pas ce problème&nbsp;;</li>

</ul>

<p>

Michael Meskes a commité&nbsp;: </p>

<ul><li>

l'ajustement du fichier nécessaire à MinGW en fonction du fichier attendu par le nouveau script d'installation avec le bon numéro de port&nbsp;;</li>

<li>

la simplification de la gestion de regression d'ecpg et l'ajout du correctif de Joachim Wieland du bug dans la suite de regression sous OpenBSD&nbsp;;</li>

<li>

dans ecpg, l'application du correctif de Joachim pour l'option --regression. Puisque cette option marque les fichiers .c, les variables d'environnement ne sont plus nécessaires. Un fichier MinGW spécial a été créé avec le message d'erreur particulier. Le numéro de port n'est plus écrit dans le journal lors du déroulement des tests de régression.</li>

</ul>

<p>

Neil Conway a commité&nbsp;: </p>

<ul><li>

l'ajout d'une note dans les docs pour décrire le comportement du tri et de l'égalité de NaN (Not a Number). D'après un fil de discussion récent sur -hackers, c'était nécessaire car Postgres se comporte différement de la plupart des implantations de NaN, dont IEEE754&nbsp;;</li>

<li>

un correctif de Magnus Hagander et Joachim Wieland à   pgsql/src/tools/msvc/gendef.pl qui corrige deux problèmes&nbsp;: gendef fonctionne à l'intérieur de visual studio - avec l'utilisation d'un fichier temporaire plutôt qu'une redirection (pour diverses raisons, il n'est pas possible de rediriger dumpbin) et gendef ne peut travailler que sur des *.obj, dans le cas contraire, il produira des résultats hasardeux dans divers scénarios de construction lorsqu'il tentera de jouer un logfile&nbsp;;</li>

<li>

le correctif de pgsql/src/tools/msvc/build.bat qui active une sortie verbeuse lors de la construction de tous les projets. Le même niveau de sortie était utilisé lors de la construction d'un seul projet auparavant. Il était réellement nécessaire de produire des informations raisonnables sur ce qu'il se passe (le mode non-verbeux dit juste "starting build of foo" et "done building foo", à peu de choses près).</li>

</ul>

<p>

ISHII Tatsuo a commité&nbsp;: </p>

<ul><li>

le correctif rétro des versions 8.0, 7.4 et 7.3. Celui-ci appelle srandom() en lieu et place de srand(). pgbench appelle random() par la suite, alors qu'il devrait appeler srandom(). Sur la plupart des plateformes, à l'exception de Windows srandom() est en fait équivalent à srand(). Le bogue ne touche donc que les utilisateurs de Windows users. D'après le rapport de bogue de Akio Ishida&nbsp;;</li>

<li>

la mise à jour de l'année de copyright dans contrib/pgbench.</li>

</ul>

<p>

Bruce Momjian a commité&nbsp;: </p>

<ul><li>

la suppression des items traités et devenus inutiles de la TODO LIST, dont "Fix memory leak from exceptions" (fait), "Allow constraint_exclusion to work for UNIONs like it does for   inheritance, allow it to work for UPDATE and DELETE statements, and   allow it to be used for all statements with little performance impact" (fait), "Add estimated_count(*) to return an estimate of COUNT(*)" (plus souhaité) </li>

<li>

la mise à jour de la description de to_char("CC")&nbsp;;</li>

<li>

la mise à jour du message d'erreur dans pgsql/src/backend/parser/analyze.c&nbsp;;</li>

<li>

la mise à jour des messages ORDER BY UNION (encore)&nbsp;;</li>

<li>

la mise à jour des messages des expressions/fonctions UNION/INTERSECT/EXCEPT ORDER BY&nbsp;;</li>

<li>

l'amélioration des messages d'ORDER BY dans UNION qui utilisent les nouvelles expressions d'ORDER BY&nbsp;;</li>

<li>

l'ajout à la TODO LIST de&nbsp;: "Add URL item for psql -c changes"

<a target="_blank" href="http://archives.postgresql.org/pgsql-hackers/2007-01/msg00291.php">http://archives.postgresql.org/pgsql-hackers/2007-01/msg00291.php</a>;nbsp;;

</li>

<li>

l'ajout à la TODO LIST de&nbsp;: "Fix transaction restriction checks for CREATE   DATABASE and other commands"

<a target="_blank" href="http://archives.postgresql.org/pgsql-hackers/2007-01/msg00133.php">http://archives.postgresql.org/pgsql-hackers/2007-01/msg00133.php</a>&nbsp;;

</li>

<li>

l'ajout à la TODO LIST de&nbsp;: "Add URL for PQexec() for disallowing multiple   queries"

<a target="_blank" href="http://archives.postgresql.org/pgsql-hackers/2007-01/msg00184.php">http://archives.postgresql.org/pgsql-hackers/2007-01/msg00184.php</a>&nbsp;;

</li>

<li>

l'ajout à la TODO LIST de&nbsp;: "Extend timezone code to allow 64-bit values so we   can represent years beyond 2038."

<a target="_blank" href="http://archives.postgresql.org/pgsql-hackers/2006-09/msg01363.php">http://archives.postgresql.org/pgsql-hackers/2006-09/msg01363.php</a>

</li>

<li>

l'ajout à la TODO LIST de: "Move NAMEDATALEN from postgres_ext.h to   pg_config_manual.h and consider making it more configurable in future releases." </li>

<li>

le correctif de L Bayuk qui permet à BCC de compiler libpq et psql&nbsp;;</li>

<li>

l'ajout pour pg_ctl -w de la référence aux variables d'environnement additionnelles et à pgpass&nbsp;;</li>

<li>

la suppression dans le makefile SGML du tag .SECONDARY afin que les règles html fonctionnent correctement&nbsp;; amélioration de la documentation et des commentaires&nbsp;;</li>

<li>

l'amélioration des règles de construction SGML pour les sorties non-HTML output, per Peter Eisentraut&nbsp;;</li>

<li>

la mise à jour du script de copyright pour permettre les espaces entre les tirets longs (dash)&nbsp;;</li>

<li>

dans le Makefile SGML, le positionnement des cibles appropriées aux appels récursifs&nbsp;;</li>

<li>

l'ajout de "Improve merge join performance by allowing mark/restore of tuple sources" à la TODO list&nbsp;;</li>

<li>

le correctif de Michael Fuhr qui actualise les références RFC pour UTF-8. La RFC   2044 est rendue obsolète par la RFC 2279, elle même rendue obsolète par la RFC 3629&nbsp;;</li>

<li>

la documentation SGML doit être construite plusieurs fois pour obtenir les bons index&nbsp;; d'où l'ajout de l'option 'draft' pour désactiver ce fonctionnement&nbsp;;</li>

<li>

le passage des log_temp_files en kilooctets et la suppression des appels à trace&nbsp;;</li>

<li>

la suppression des appel à la macro trace à partir des nouveaux log_temp_files, en attendant une recherche plus approfondie&nbsp;;</li>

<li>

le correctif de Heikki Linnakangas qui autorise d'autres octets de statut à cinq tupes en utilisant les octets de poids fort du champ nattr et en renommant le champ&nbsp;;</li>

<li>

dans la TODO list le passage en "fait" de&nbsp;: "Add ability to monitor the use of temporary   sort files"&nbsp;</li>

<li>

le correctif de Bruce Moran qui ajoute une variable de configuration log_temp_files pour journaliser l'utilisation de fichiers temporaires&nbsp;;</li>

<li>

dans le TODO list, le passage en "fait" de&nbsp;: "Allow the creation of indexes with mixed   ascending/descending." Le correctif ORDER BY ... NULL FIRST/LAST de Tom Lane l'implante.</li>

</ul>

<p>

Tom Lane a commité&nbsp;: </p>

<ul><li>

un correctif de gestion du format CC (century) dans to_date/to_char. D'après le standard, le 21è siècle s'étend de 2001 à 2100, et non de 2000 à 2099. Autant que cela fonctionne ainsi. Per bug #2885 de Akio Iwaasa. Correctif rétro de 8.2, mais pas plus puisqu'il s'agit en fait d'une modification de définition&nbsp;; les utilisateurs des autres branches recherchent certainement plutôt la stabilité&nbsp;;</li>

<li>

l'ajout de notes à pgsql/src/backend/access/nbtree/README concernant les règles mathématiques de base que le système tient pour vrai pour les opérateurs d'une famille btree. Il s'agit essentiellement de clarifier ma propre pensée de ce que le planificateur peut assumer dans un but d'optimisation. (dépoussié un vieux livre d'algèbre abstrait...)&nbsp;;</li>

<li>

la correction d'un problème de performance dans les bases contenant un grand nombre de tables (ou d'autres types d'entrées dans pg_class)&nbsp;: le temps d'exécution de la fonction pgstat_vacuum_tabstat, invoquée au démarrage de VACUUM, est proportionnel au nombre de stats d'entrée dans la table multiplié par le nombre de lignes dans pg_class&nbsp;; en d'autres mots O(N^2) si les informations du collecteur de stats sont complètes. Le parcours de liste à été remplacé par une table de hachage pour le ramener à un comportement O(N). D'après un rapport de kim   at myemma.com. Correctif rétro jusqu'à 8.1; 8.0 and before use   different coding here&nbsp;;</li>

<li>

la gestion par nodeMergejoin des ordres de tri DESC et/ou NULLS FIRST. N'a été testé à ce jour qu'en "hackant" le planificateur...</li>

<li>

l'assurance que BYTE_ORDER est défini sur les constructions 64-bits Solaris, per   Stefan Kaltenbrunner&nbsp;;</li>

<li>

la modification de l'API planner-to-executor pour que le planificateur annonce à l'exécuteur lles opérateurs de comparaison à utiliser pour les noeuds des plans qui comprennent des comparaisons de tuple (Agg, Group, Unique, SetOp). Auparavant, l'exécuteur recherchait l'opérateur d'égalité par défaut pour le type de données, ce qui n'était pas satisfaisant, puisqu'il est possible que les données passées au nœud soit ordonnées par une classe d'opérateurs autre que celle par défaut et qui peut avoir une idée incompatible de l'égalité. Le planificateur sait comment les données ont été triées et peut donc fournir l'opérateur d'égalité adéquat. Qui plus est, cette modification déplace un certain nombre de parcours du catalogue de l'exécuteur au planificateur, ce qui peut accélérer le démarrage des requêtes déjà planifiées. Le planificateur a été modifié pour supprimer d'autres hypothèses cavalières quant à l'utilisation de l'opérateur par défaut. L'information "nulls first/last" a également été ajoutée au nœud du Plan pour une jointure de fusion --- ni le planificateur, ni l'exécuteur ne savent le gérer, mais au moins l'API est en place&nbsp;;</li>

<li>

quelques modifications dans la documentation d'ORDER BY&nbsp;; en particulier la mise en relief de la différence entre ORDER BY x, y DESC et ORDER BY x DESC, y DESC&nbsp;;</li>

<li>

l'ajout d'une citation d'un article de 1991 de Seltzer et Yigit concernant la gestion des tables de hachage dans pgsql/src/backend/access/hash/README. L'article décrit clairement la plupart des idées présentes dans notre code de hachage, mais pour autant que j'ai pu constater, il n'y a pas d'héritage direct de code. (Mike Olsen rappelle la discussion de cet article dans les meetings Postgres, mais estime que "cela n'a probablement servi à Postgres que dans la phase de conception". Margo elle-même avour qu'elle n'était pas impliquée dans le code Postgres du hachage.) Créditons ce qui doit l'être, même 15 ans après&nbsp;;</li>

<li>

le correctif de Magnus Hagander à pgsql/src/tools/msvc qui corrige vcbuild pour permettre la construction sans OpenSSL mais/ni zlib&nbsp;;</li>

<li>

l'ajout d'un README dans pgsql/src/tools/msvc avec la documentation de Magnus Hagander et Dave Page&nbsp;;</li>

<li>

le test de régression de pltcl doit créer un opclass, et non juste un opérateur&nbsp;;</li>

<li>

le support d'ORDER BY ... NULLS FIRST/LAST et l'ajout des options par colonne de ASC/DESC/NULLS   FIRST/NULLS LAST pour les index btree. Le support du planificateur pour ceux-ci est toujours rudimentaire&nbsp;; il ne sait toujours pas comment planifier les jointures-fusion qui n'utilisent pas les options de tri par défaut. La documentation est tout aussi rudimentaire. Je travaillerai à son amélioration plus tard. Une modification incompatible est notée&nbsp;: ORDER BY ... USING sera maintenant rejetée si l'opérateur n'est pas un membre supérieur ou inférieur d'une classe d'opérateur btree. Cela permet d'éviter unn comportement dangereux si un opérateur qui ne définit un ordre de tri adéquat est sélectionné&nbsp;;</li>

<li>

la modification de la création des listes de jointures pour éviter la génération de sous-problèmes à un élément inutiles lorsque la construction des arbres JOIN est stoppée par join_collapse_limit. Par exemple, une liste de 11 LEFT JOIN avec une limite de 8 produit quelque chose comme ((1 2 3 4 5 6 7 8) 9 10 11 12) et non (((1 2 3 4 5 6 7 8) (9)) 10 11 12). Cette dernière n'étant réellement nécessaire que dans le cas d'un FULL JOIN. Relevé lors de l'étude d'un exemple de Shane Ambler&nbsp;;</li>

<li>

la suppression d'un très vieux hack de cost_hashjoin pour décourager (avant d'interdire complètement) les jointures de hachage dont la relation estimée la plus large est interne. Il y a de nombreux cas où cela à un sens, et dans le cas où cela n'en a pas, le calcul du coût doit en tenir compte. Diverses modifications on été réalisées sur ce calcul pour essayer d'obtenir des résultats approchant mieux la réalité. D'après un exemple de Shane Ambler. Le correctif original a également été corrigé pour ajouter seq_page_cost&nbsp;: les coûts de décomposition d'une jointure de hachage doivent être proportionnels à seq_page_cost.</li>

</ul>

<p>

D'Arcy Cain a commité&nbsp;: </p>

<ul><li>

l'élargissement du type money à 64 octets.</li>

</ul>

<p>

Peter Eisentraut a commité&nbsp;: </p>

<ul><li>

la correction de la compilation des expressions IS DOCUMENT&nbsp;;</li>

<li>

l'ajout du support des expressions xmlval IS DOCUMENT&nbsp;;</li>

<li>

la correction des avertissements de compilation dans pgsql/src/backend/parser/parse_expr.c&nbsp;;</li>

<li>

l'utilisation des échappements XML dans XMLFOREST&nbsp;;</li>

<li>

l'autorisation des types de données arbitraires comme contenu de XMLELEMENT. Le transtypage original vers le type xml était une erreur. Les valeurs sont échappées pour devenir des caractères XML valides.&nbsp;;</li>

<li>

l'utilisation de l'API xmlwriter de la libxml pour produire des éléments XML, plutôt que de réaliser notre propre gestion d'impression. Le résultat de mise entre guillemets et d'échappement des valeurs est meilleur&nbsp;;</li>

<li>

l'interdiction des noms d'attribut dupliqués dans XMLELEMENT&nbsp;;</li>

<li>

de l'optimisation de xmlpi dans les coins&nbsp;: correction des codes d'erreur,  vérifications de syntaxe dans le bon ordre et suppression des espaces en début d'argument&nbsp;;</li>

<li>

la vérification et la documentation de la version minimale de libxml requise&nbsp;;</li>

</ul>

<p><strong>Correctifs rejetés (à ce jour)</strong></p>

<p>

Pas de déception cette semaine.

</p>

<p><strong>Correctifs en attente</strong></p>

<ul>

<li>

Simon Riggs a envoyé deux versions d'un correctif qui autorise à éviter d'écrire les WAL lors d'un COPY à l'intérieur d'une transaction explicite&nbsp;;</li>

<li>

Gurjeet Singh a envoyé une nouvelle révision de son correctif de l'Index Advisor&nbsp;;</li>

<li>

Dave Page a envoyé un correctif qui permet à pg_dumpall de sauvegarder les rôles et les tablespaces&nbsp;;</li>

<li>

Pavel Stehule a envoyé un correctif qui ajoute le support de parcours des curseurs à SPI.</li>

</ul>