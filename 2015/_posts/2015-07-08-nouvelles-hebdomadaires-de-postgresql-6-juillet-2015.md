---
layout: post
title: "Nouvelles hebdomadaires de PostgreSQL - 6 juillet 2015"
author: "NBougain"
redirect_from: "index.php?post/2015-07-08-nouvelles-hebdomadaires-de-postgresql-6-juillet-2015 "
---


<p>Le programme de la CommitFest pour le cycle de la 9.6 s'articule ainsi&nbsp;:<br>

CF1: 1 au 31 juillet 2015<br>

CF2: 1 au 30 septembre 2015<br>

CF3: 1 au 30 novembre 2015<br>

CF4: 2 au 31 janvier 2016<br>

CF5: 1 au 31 mars 2016, pour finir dans les temps (patch rejet&eacute; par mort subite)<br>

Feature Freeze (committer freeze): 15 avril.<br>

<a target="_blank" href="https://wiki.postgresql.org/wiki/PgCon_2015_Developer_Meeting#9.6_Schedule">https://wiki.postgresql.org/wiki/PgCon_2015_Developer_Meeting#9.6_Schedule</a></p>

<p>PostgreSQL 9.5 Alpha 1 disponible. &Agrave; vos tests&nbsp;! <a target="_blank" href="http://www.postgresql.org/about/news/1595/">http://www.postgresql.org/about/news/1595/</a></p>

<p><em>PostgreSQL Conference Europe 2015</em> aura lieu du 27 au 30 octobre au Vienna Marriott Hotel &agrave; Vienne (Autriche). L'appel &agrave; conf&eacute;renciers est lanc&eacute; jusqu'au 7 ao&ucirc;t&nbsp;: <a target="_blank" href="http://2015.pgconf.eu/">http://2015.pgconf.eu/</a></p>

<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>

<ul>

<li>SQL Tabs v0.4, un outil client pour PostgreSQL&nbsp;: <a target="_blank" href="http://www.sqltabs.com/">http://www.sqltabs.com/</a></li>

<li>Version 2.22.0 de check_postgres, un outil de surveillance de PostgreSQL&nbsp;: <a target="_blank" href="http://bucardo.org/wiki/Check_postgres">http://bucardo.org/wiki/Check_postgres</a></li>

<li>Role::Pg::Roles 0.002, un module Perl pour la manipulation de r&ocirc;les&nbsp;: <a target="_blank" href="https://metacpan.org/pod/Role::Pg::Roles">https://metacpan.org/pod/Role::Pg::Roles</a></li>

<li>Role::Pg::Sequences 0.002, un module Perl pour la manipulation de s&eacute;quences&nbsp;: <a target="_blank" href="https://metacpan.org/pod/Role::Pg::Roles">https://metacpan.org/pod/Role::Pg::Roles</a></li>

<li>Role::Pg::Notify 0.001, un module Perl pour la manipulation de la l'instruction NOTIFY&nbsp;: <a target="_blank" href="https://metacpan.org/pod/Role::Pg::Roles">https://metacpan.org/pod/Role::Pg::Roles</a></li>

<li>Job::Machine 0.22, un module Perl pour la cr&eacute;ation et l'utilisation de files d'attente de travaux&nbsp;: <a target="_blank" href="https://metacpan.org/pod/Job::Machine">https://metacpan.org/pod/Job::Machine</a></li>

</ul>

<h2>Offres d'emplois autour de PostgreSQL en juillet</h2>

<ul>

<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2015-07/">http://archives.postgresql.org/pgsql-jobs/2015-07/</a></li>

<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>

</ul>

<h2>PostgreSQL Local</h2>

<ul>

<li>La conf&eacute;rence PGDay UK aura lieu le 7 juillet 2015 - elle vise les membres de la communaut&eacute; PostgreSQL anglaise&nbsp;: <a target="_blank" href="http://www.postgresqlusergroup.org.uk">http://www.postgresqlusergroup.org.uk</a></li>

<li>Le <em>PGDay Campinas 2015</em> aura lieu &agrave; Campinas (Br&eacute;sil) le 7 ao&ucirc;t&nbsp;: <a target="_blank" href="http://pgdaycampinas.com.br/english/">http://pgdaycampinas.com.br/english/</a></li>

<li>Le PostgresOpen 2015 aura lieu &agrave; Dallas (Texas, USA) du 16 au 18 septembre&nbsp;: <a target="_blank" href="http://2015.postgresopen.org/">http://2015.postgresopen.org/</a></li>

<li>La <em>session PostgreSQL n&deg;7</em> aura lieu le 24 septembre 2015 &agrave; Paris (France)&nbsp;: <a target="_blank" href="http://www.postgresql-sessions.org/7/about">http://www.postgresql-sessions.org/7/about</a></li>

<li><em>PostgreSQL Conference Europe 2015</em> aura lieu du 27 au 30 octobre au Vienna Marriott Hotel &agrave; Vienne (Autriche). L'appel &agrave; conf&eacute;renciers est lanc&eacute; jusqu'au 7 ao&ucirc;t&nbsp;: <a target="_blank" href="http://2015.pgconf.eu/">http://2015.pgconf.eu/</a></li>

<li><em>PGConf Silicon Valley 2015</em> se tiendra au centre de convention sud de San Francisco les 17 &amp; 18 novembre&nbsp;: <a target="_blank" href="http://www.pgconfsv.com">http://www.pgconfsv.com</a></li>

<li>PGBR2015 (la PgConf br&eacute;silienne) aura lieu &agrave; Porto Alegre (&Eacute;tat du Rio Grande do Sul) les 18, 19 et 20 novembre. L'appel &agrave; conf&eacute;renciers expire le 15 juillet&nbsp;: <a target="_blank" href="http://pgbr.postgresql.org.br/2015/en/#call-for-papers">http://pgbr.postgresql.org.br/2015/en/#call-for-papers</a></li>

</ul>

<h2>PostgreSQL dans les m&eacute;dia</h2>

<ul>

<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>

<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>

</ul>

<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20150707033145.GA22974@fetter.org">http://www.postgresql.org/message-id/20150707033145.GA22974@fetter.org</a></p>

<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>

<!--more-->


<h2>Correctifs appliqu&eacute;s</h2>

<p>Heikki Linnakangas pushed:</p>

<ul>

<li>Also trigger restartpoints based on max_wal_size on standby. When archive recovery and restartpoints were initially introduced, checkpoint_segments was ignored on the grounds that the files restored from archive don't consume any space in the recovery server. That was changed in later releases, but even then it was arguably a feature rather than a bug, as performing restartpoints as often as checkpoints during normal operation might be excessive, but you might nevertheless not want to waste a lot of space for pre-allocated WAL by setting checkpoint_segments to a high value. But now that we have separate min_wal_size and max_wal_size settings, you can bound WAL usage with max_wal_size, and still avoid consuming excessive space usage by setting min_wal_size to a lower value, so that argument is moot. There are still some issues with actually limiting the space usage to max_wal_size: restartpoints in recovery can only start after seeing the checkpoint record, while a checkpoint starts flushing buffers as soon as the redo-pointer is set. Restartpoint is paced to happen at the same leisurily speed, determined by checkpoint_completion_target, as checkpoints, but because they are started later, max_wal_size can be exceeded by upto one checkpoint cycle's worth of WAL, depending on checkpoint_completion_target. But that seems better than not trying at all, and max_wal_size is a soft limit anyway. The documentation already claimed that max_wal_size is obeyed in recovery, so this just fixes the behaviour to match the docs. However, add some weasel-words there to mention that max_wal_size may well be exceeded by some amount in recovery. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d661532e27b34e9c89d0700c6ce246731e70072c">http://git.postgresql.org/pg/commitdiff/d661532e27b34e9c89d0700c6ce246731e70072c</a></li>

<li>Initialize GIN metapage correctly when replaying metapage-update WAL record. I broke this with my WAL format refactoring patch. Before that, the metapage was read from disk, and modified in-place regardless of the LSN. That was always a bit silly, as there's no need to read the old page version from disk disk when we're overwriting it anyway. So that was changed in 9.5, but I failed to add a GinInitPage call to initialize the page-headers correctly. Usually you wouldn't notice, because the metapage is already in the page cache and is not zeroed. One way to reproduce this is to perform a VACUUM on an already vacuumed table (so that the vacuum has no real work to do), immediately after a checkpoint, and then perform an immediate shutdown. After recovery, the page headers of the metapage will be incorrectly all-zeroes. Reported by Jeff Janes <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/47fe4d25d57c81b9d7b2ac88783a12ee487db220">http://git.postgresql.org/pg/commitdiff/47fe4d25d57c81b9d7b2ac88783a12ee487db220</a></li>

<li>Don't call PageGetSpecialPointer() on page until it's been initialized. After calling XLogInitBufferForRedo(), the page might be all-zeros if it was not in page cache already. btree_xlog_unlink_page initialized the page correctly, but it called PageGetSpecialPointer before initializing it, which would lead to a corrupt page at WAL replay, if the unlinked page is not in page cache. Backpatch to 9.4, the bug came with the rewrite of B-tree page deletion. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fdf28853ae6a397497b79fea69f89f4f7b9aa991">http://git.postgresql.org/pg/commitdiff/fdf28853ae6a397497b79fea69f89f4f7b9aa991</a></li>

<li>Add assertion to check the special size is sane before dereferencing it. This seems useful to catch errors of the sort I just fixed, where PageGetSpecialPointer is called before initializing the page. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/302ac7f27197855afa8c89fae36c85c124ae156b">http://git.postgresql.org/pg/commitdiff/302ac7f27197855afa8c89fae36c85c124ae156b</a></li>

<li>Use American spelling for "behavior". For consistency with the rest of the docs. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5b1b6bf49b44f9b26f0c9eb6d97e84973e71a0ae">http://git.postgresql.org/pg/commitdiff/5b1b6bf49b44f9b26f0c9eb6d97e84973e71a0ae</a></li>

<li>Fix name of argument to pg_stat_file. It's called "missing_ok" in the docs and in the C code. I refrained from doing a catversion bump for this, because the name of an input argument is just documentation, it has no effect on any callers. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7931622d1d942dbbba8d0eab77f18f69f1ce5de0">http://git.postgresql.org/pg/commitdiff/7931622d1d942dbbba8d0eab77f18f69f1ce5de0</a></li>

<li>Use appendStringInfoString/Char et al where appropriate. Patch by David Rowley. Backpatch to 9.5, as some of the calls were new in 9.5, and keeping the code in sync with master makes future backpatching easier. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f92d6a540ac443f85f0929b284edff67da14687a">http://git.postgresql.org/pg/commitdiff/f92d6a540ac443f85f0929b284edff67da14687a</a></li>

<li>Don't emit a spurious space at end of line in pg_dump of event triggers. Backpatch to 9.3 and above, where event triggers were added. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7b156c1e0746a46d083d7dbcd28afb303b3484ef">http://git.postgresql.org/pg/commitdiff/7b156c1e0746a46d083d7dbcd28afb303b3484ef</a></li>

<li>Replace obsolete autoconf macros with their modern replacements. AC_TRY_COMPILE(...) -&gt; AC_COMPILE_IFELSE([AC_LANG_PROGRAM(...)]) AC_TRY_LINK(...) -&gt; AC_LINK_IFELSE([AC_LANG_PROGRAM(...)]) AC_TRY_RUN(...) -&gt; AC_RUN_IFELSE([AC_LANG_PROGRAM(...)]) AC_LANG_SAVE/RESTORE -&gt; AC_LANG_PUSH/POP AC_DECL_SYS_SIGLIST -&gt; AC_CHECK_DECLS(...) (per snippet in autoconf manual) Also use AC_LANG_SOURCE instead of AC_LANG_PROGRAM, where the main() function is not needed. With these changes, autoconf -Wall doesn't complain anymore. Andreas Karlsson <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a2edb023d08778c3346bbbf4ca82ef7f6e9283eb">http://git.postgresql.org/pg/commitdiff/a2edb023d08778c3346bbbf4ca82ef7f6e9283eb</a></li>

<li>Plug some trivial memory leaks in pg_dump and pg_upgrade. There's no point in trying to free every small allocation in these programs that are used in a one-shot fashion, but these ones seems like an improvement on readability grounds. Michael Paquier, per Coverity report. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f712289ffad7c3fb6eb3be4f81adb0aa0981c9f7">http://git.postgresql.org/pg/commitdiff/f712289ffad7c3fb6eb3be4f81adb0aa0981c9f7</a></li>

<li>Remove "const" from convertTSFunction()'s return type. There's no particular reason to mark it as such. The other convert* functions have no const either. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a3fd7afe3090a5098f93408d47da70b47fb59e7b">http://git.postgresql.org/pg/commitdiff/a3fd7afe3090a5098f93408d47da70b47fb59e7b</a></li>

<li>Remove obsolete heap_formtuple/modifytuple/deformtuple functions. These variants used the old-style 'n'/' ' NULL indicators. The new-style functions have been available since version 8.1. That should be long enough that if there is still any old external code using these functions, they can just switch to the new functions without worrying about backwards compatibility. Peter Geoghegan <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/726117243022178e72966cbffdfb9147ec6dbbcc">http://git.postgresql.org/pg/commitdiff/726117243022178e72966cbffdfb9147ec6dbbcc</a></li>

<li>Lift the limitation that # of clients must be a multiple of # of threads. Fabien Coelho <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ba3deeefb0fb9e8810b454bc7b41f27965c24aa8">http://git.postgresql.org/pg/commitdiff/ba3deeefb0fb9e8810b454bc7b41f27965c24aa8</a></li>

<li>Fix pgbench progress report behaviour when pgbench or a query gets stuck. There were two issues here. First, if a query got stuck so that it took e.g. 5 seconds, and progress interval was 1 second, no progress reports were printed until the query returned. Fix so that we wake up specifically to print the progress report. Secondly, if pgbench got stuck so that it would nevertheless not print a progress report on time, and enough time passes that it's already time to print the next progress report, just skip the one that was missed. Before this patch, it would print the missed one with 0 TPS immediately after the previous one. Fabien Coelho. Backpatch to 9.4, where progress reports were added. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9031ff91a110f29e8bd4b74ddf2b5ced3ecbeaf4">http://git.postgresql.org/pg/commitdiff/9031ff91a110f29e8bd4b74ddf2b5ced3ecbeaf4</a></li>

<li>Remove thread-emulation support from pgbench. You can no longer use pgbench with multiple threads when compiled without --enable-thread-safety. That's an acceptable limitation these days; it still works fine with -j1, and all modern platforms support threads anyway. This makes future maintenance and development of the code easier. Fabien Coelho <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1bc90f7a7b7441a88e2c6d4a0e9b6f9c1499ad30">http://git.postgresql.org/pg/commitdiff/1bc90f7a7b7441a88e2c6d4a0e9b6f9c1499ad30</a></li>

<li>Don't set SO_SNDBUF on recent Windows versions that have a bigger default. It's unnecessary to set it if the default is higher in the first place. Furthermore, setting SO_SNDBUF disables the so-called "dynamic send buffering" feature, which hurts performance further. This can be seen especially when the network between the client and the server has high latency. Chen Huajun <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4f33621f3f50286e607a3cdcc1f7a7d51075af95">http://git.postgresql.org/pg/commitdiff/4f33621f3f50286e607a3cdcc1f7a7d51075af95</a></li>

<li>Call getsockopt() on the correct socket. We're interested in the buffer size of the socket that's connected to the client, not the one that's listening for new connections. It happened to work, as default buffer size is the same on both, but it was clearly not wrong. Spotted by Tom Lane <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8e33fc1784cbd657a7238ab5639ee1f8f54a3ec0">http://git.postgresql.org/pg/commitdiff/8e33fc1784cbd657a7238ab5639ee1f8f54a3ec0</a></li>

<li>Turn install.bat into a pure one line wrapper fort he perl script. Build.bat and vcregress.bat got similar treatment years ago. I'm not sure why install.bat wasn't treated at the same time, but it seems like a good idea anyway. The immediate problem with the old install.bat was that it had quoting issues, and wouldn't work if the target directory's name contained spaces. This fixes that problem. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6c534fd68568452adcc9ccecb557eff74f6f0f4d">http://git.postgresql.org/pg/commitdiff/6c534fd68568452adcc9ccecb557eff74f6f0f4d</a></li>

</ul>

<p>Tom Lane pushed:</p>

<ul>

<li>Improve design and implementation of pg_file_settings view. As first committed, this view reported on the file contents as they were at the last SIGHUP event. That's not as useful as reporting on the current contents, and what's more, it didn't work right on Windows unless the current session had serviced at least one SIGHUP. Therefore, arrange to re-read the files when pg_show_all_settings() is called. This requires only minor refactoring so that we can pass changeVal = false to set_config_option() so that it won't actually apply any changes locally. In addition, add error reporting so that errors that would prevent the configuration files from being loaded, or would prevent individual settings from being applied, are visible directly in the view. This makes the view usable for pre-testing whether edits made in the config files will have the desired effect, before one actually issues a SIGHUP. I also added an "applied" column so that it's easy to identify entries that are superseded by later entries; this was the main use-case for the original design, but it seemed unnecessarily hard to use for that. Also fix a 9.4.1 regression that allowed multiple entries for a PGC_POSTMASTER variable to cause bogus complaints in the postmaster log. (The issue here was that commit bf007a27acd7b2fb unintentionally reverted 3e3f65973a3c94a6, which suppressed any duplicate entries within ParseConfigFp. However, since the original coding of the pg_file_settings view depended on such suppression *not* happening, we couldn't have fixed this issue now without first doing something with pg_file_settings. Now we suppress duplicates by marking them "ignored" within ProcessConfigFileInternal, which doesn't hide them in the view.) Lesser changes include: Drive the view directly off the ConfigVariable list, instead of making a basically-equivalent second copy of the data. There's no longer any need to hang onto the data permanently, anyway. Convert show_all_file_settings() to do its work in one call and return a tuplestore; this avoids risks associated with assuming that the GUC state will hold still over the course of query execution. (I think there were probably latent bugs here, though you might need something like a cursor on the view to expose them.) Arrange to run SIGHUP processing in a short-lived memory context, to forestall process-lifespan memory leaks. (There is one known leak in this code, in ProcessConfigDirectory; it seems minor enough to not be worth back-patching a specific fix for.) Remove mistaken assignment to ConfigFileLineno that caused line counting after an include_dir directive to be completely wrong. Add missed failure check in AlterSystemSetConfigFile(). We don't really expect ParseConfigFp() to fail, but that's not an excuse for not checking. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/62d16c7fc5614d9f4d0dd1a9f164b232c273c128">http://git.postgresql.org/pg/commitdiff/62d16c7fc5614d9f4d0dd1a9f164b232c273c128</a></li>

<li>Run the C portions of guc-file.l through pgindent. Yeah, I know, pretty anal-retentive of me. But we oughta find some way to automate this for the .y and .l files. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2bdc51a2946f9a66688eb705cd0cb584ebd8240a">http://git.postgresql.org/pg/commitdiff/2bdc51a2946f9a66688eb705cd0cb584ebd8240a</a></li>

<li>Code + docs review for escaping of option values (commit 11a020eb6). Avoid memory leak from incorrect choice of how to free a StringInfo (resetStringInfo doesn't do it). Now that pg_split_opts doesn't scribble on the optstr, mark that as "const" for clarity. Attach the commentary in protocol.sgml to the right place, and add documentation about the user-visible effects of this change on postgres' -o option and libpq's PGOPTIONS option. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cbc8d65639344c390a1d1a7f646c186ff3ad8693">http://git.postgresql.org/pg/commitdiff/cbc8d65639344c390a1d1a7f646c186ff3ad8693</a></li>

<li>Desultory review of 9.5 release notes. Minor corrections and clarifications. Notably, for stuff that got moved out of contrib, make sure it's documented somewhere other than "Additional Modules". I'm sure these need more work, but that's all I have time for today. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/85c25fdbd7d624928bb8a1f1fd1e5043ec35dd74">http://git.postgresql.org/pg/commitdiff/85c25fdbd7d624928bb8a1f1fd1e5043ec35dd74</a></li>

<li>Stamp 9.5alpha1. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f78329d594c2fe893f9174d5b3da7d3fbc6dd8b6">http://git.postgresql.org/pg/commitdiff/f78329d594c2fe893f9174d5b3da7d3fbc6dd8b6</a></li>

<li>Remove useless check for NULL subexpression. Coverity rightly gripes that it's silly to have a test here when the adjacent ExecEvalExpr() would choke on a NULL expression pointer. Petr Jelinek <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/131926a52da0fbd77678cbd887914c83b48faa2d">http://git.postgresql.org/pg/commitdiff/131926a52da0fbd77678cbd887914c83b48faa2d</a></li>

<li>Stamp HEAD as 9.6devel. Let the hacking begin ... <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cf8d65de10ebd026f6534eeb275cae46d7bffb4f">http://git.postgresql.org/pg/commitdiff/cf8d65de10ebd026f6534eeb275cae46d7bffb4f</a></li>

<li>Stamp shared-library minor version numbers for 9.6. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/019f7813da69da05484faa63b6a29a8df773d19b">http://git.postgresql.org/pg/commitdiff/019f7813da69da05484faa63b6a29a8df773d19b</a></li>

<li>Fix broken link in documentation. HP's web server has apparently become case-sensitive sometime recently. Per bug #13479 from Daniel Abraham. Corrected link identified by Alvaro. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7f32dbcd73b9a75d09db386fa81c31f42e6f0d3a">http://git.postgresql.org/pg/commitdiff/7f32dbcd73b9a75d09db386fa81c31f42e6f0d3a</a></li>

<li>Make sampler_random_fract() actually obey its API contract. This function is documented to return a value in the range (0,1), which is what its predecessor anl_random_fract() did. However, the new version depends on pg_erand48() which returns a value in [0,1). The possibility of returning zero creates hazards of division by zero or trying to compute log(0) at some call sites, and it might well break third-party modules using anl_random_fract() too. So let's change it to never return zero. Spotted by Coverity. Michael Paquier, cosmetically adjusted by me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d7c19d68550eb6018e8581a73a351905f4cc435c">http://git.postgresql.org/pg/commitdiff/d7c19d68550eb6018e8581a73a351905f4cc435c</a></li>

<li>Don't leave pg_hba and pg_ident data lying around in running backends. Free the contexts holding this data after we're done using it, by the expedient of attaching them to the PostmasterContext which we were already taking care to delete (and where, indeed, this data used to live before commits e5e2fc842c418432 and 7c45e3a3c682f855). This saves a probably-usually-negligible amount of space per running backend. It also avoids leaving potentially-security-sensitive data lying around in memory in processes that don't need it. You'd have to be unusually paranoid to think that that amounts to a live security bug, so I've not gone so far as to forcibly zero the memory; but there surely isn't a good reason to keep this data around. Arguably this is a memory management bug in the aforementioned commits, but it doesn't seem important enough to back-patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1e24cf645d24aab3ea39a9d259897fd0cae4e4b6">http://git.postgresql.org/pg/commitdiff/1e24cf645d24aab3ea39a9d259897fd0cae4e4b6</a></li>

<li>Add an optional missing_ok argument to SQL function current_setting(). This allows convenient checking for existence of a GUC from SQL, which is particularly useful when dealing with custom variables. David Christensen, reviewed by Jeevan Chalke <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/10fb48d66de76e7dc1e36ef18af502ed9600352f">http://git.postgresql.org/pg/commitdiff/10fb48d66de76e7dc1e36ef18af502ed9600352f</a></li>

<li>Fix misuse of TextDatumGetCString(). "TextDatumGetCString(PG_GETARG_TEXT_P(x))" is formally wrong: a text* is not a Datum. Although this coding will accidentally fail to fail on all known platforms, it risks leaking memory if a detoast step is needed, unlike "TextDatumGetCString(PG_GETARG_DATUM(x))" which is what's used elsewhere. Make pg_get_object_address() fall in line with other uses. Noted while reviewing two-arg current_setting() patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ac50f84866b22f239025bf37c9c7492cc4ce2dfd">http://git.postgresql.org/pg/commitdiff/ac50f84866b22f239025bf37c9c7492cc4ce2dfd</a></li>

<li>Make numeric form of PG version number readily available in Makefiles. Expose PG_VERSION_NUM (e.g., "90600") as a Make variable; but for consistency with the other Make variables holding similar info, call the variable just VERSION_NUM not PG_VERSION_NUM. There was some discussion of making this value available as a pg_config value as well. However, that would entail substantially more work than this two-line patch. Given that there was not exactly universal consensus that we need this at all, let's just do a minimal amount of work for now. Michael Paquier, reviewed by Pavel Stehule <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a5d489ccb7e613c7ca3be6141092b8c1d2c13fa7">http://git.postgresql.org/pg/commitdiff/a5d489ccb7e613c7ca3be6141092b8c1d2c13fa7</a></li>

<li>Improve pg_restore's -t switch to match all types of relations. -t will now match views, foreign tables, materialized views, and sequences, not only plain tables. This is more useful, and also more consistent with the behavior of pg_dump's -t switch, which has always matched all relation types. We're still not there on matching pg_dump's behavior entirely, so mention that in the docs. Craig Ringer, reviewed by Pavel Stehule <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5671aaca87c47128f6a1e0556ce9c7512096ad87">http://git.postgresql.org/pg/commitdiff/5671aaca87c47128f6a1e0556ce9c7512096ad87</a></li>

<li>Add psql \ev and \sv commands for editing and showing view definitions. These are basically just like the \ef and \sf commands for functions. Petr Korobeinikov, reviewed by Jeevan Chalke, some changes by me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8eb6407aaeb6cbd972839e356b436bb698f51cff">http://git.postgresql.org/pg/commitdiff/8eb6407aaeb6cbd972839e356b436bb698f51cff</a></li>

<li>Add documentation and regression tests concerning rounding of numerics. Michael Paquier, reviewed by Fabien Coelho <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5e7c3d91bf24a212b42c912234c6cb37d75e0292">http://git.postgresql.org/pg/commitdiff/5e7c3d91bf24a212b42c912234c6cb37d75e0292</a></li>

<li>Fix bad grammar in brin.sgml. Christoph Berg <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/252404625aa98fa5f93a45a8dcffdc179981820a">http://git.postgresql.org/pg/commitdiff/252404625aa98fa5f93a45a8dcffdc179981820a</a></li>

<li>Further reduce overhead for passing plpgsql variables to the executor. This builds on commit 21dcda2713656a7483e3280ac9d2ada20a87a9a9 by keeping a plpgsql function's shared ParamListInfo's entries for simple variables (PLPGSQL_DTYPE_VARs) valid at all times. That adds a few cycles to each assignment to such variables, but saves significantly more cycles each time they are used; so except in the pathological case of many dead stores, this should always be a win. Initial testing says it's good for about a 10% speedup of simple calculations; more in large functions with many datums. We can't use this method for row/record references unfortunately, so what we do for those is reset those ParamListInfo slots after use; which we can skip doing unless some of them were actually evaluated during the previous evaluation call. So this should frequently be a win as well, while worst case is that it's similar cost to the previous approach. Also, closer study suggests that the previous method of instantiating a new ParamListInfo array per evaluation is actually probably optimal for cursor-opening executor calls. The reason is that whatever is visible in the array is going to get copied into the cursor portal via copyParamList. So if we used the function's main ParamListInfo for those calls, we'd end up with all of its DTYPE_VAR vars getting copied, which might well include large pass-by-reference values that the cursor actually has no need for. To avoid a possible net degradation in cursor cases, go back to creating and filling a private ParamListInfo in those cases (which therefore will be exactly the same speed as before 21dcda271365). We still get some benefit out of this though, because this approach means that we only have to defend against copyParamList's try-to-fetch-every-slot behavior in the case of an unshared ParamListInfo; so plpgsql_param_fetch() can skip testing expr-&gt;paramnos in the common case. To ensure that the main ParamListInfo's image of a DTYPE_VAR datum is always valid, all assignments to such variables are now funneled through assign_simple_var(). But this makes for cleaner and shorter code anyway. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6c82d8d1fdb1f1265f93d89640edcbd0ae22c627">http://git.postgresql.org/pg/commitdiff/6c82d8d1fdb1f1265f93d89640edcbd0ae22c627</a></li>

<li>Fix some typos in regression test comments. Back-patch to avoid unnecessary cross-branch differences. CharSyam <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/551654977022097ac408b483b3be9887a99f0ce0">http://git.postgresql.org/pg/commitdiff/551654977022097ac408b483b3be9887a99f0ce0</a></li>

<li>Make a editorial pass over pgbench's error messages. The lack of consistency, and lack of attention to our message style guidelines, was a bit striking. Try to make 'em better. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/22ba5563adacd162d97ff3c80eac4893574f1e17">http://git.postgresql.org/pg/commitdiff/22ba5563adacd162d97ff3c80eac4893574f1e17</a></li>

</ul>

<p>Peter Eisentraut pushed:</p>

<ul>

<li>Translation updates. Source-Git-URL: git://git.postgresql.org/git/pgtranslation/messages.git Source-Git-Hash: fb7e72f46cfafa1b5bfe4564d9686d63a1e6383f <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c5e5d444de85a7caff462443c5915544d4406a62">http://git.postgresql.org/pg/commitdiff/c5e5d444de85a7caff462443c5915544d4406a62</a></li>

</ul>

<p>Andres Freund pushed:</p>

<ul>

<li>Replace ia64 S_UNLOCK compiler barrier with a full memory barrier. _Asm_sched_fence() is just a compiler barrier, not a memory barrier. But spinlock release on IA64 needs, at the very least, release semantics. Use a full barrier instead. This might be the cause for the occasional failures on buildfarm member anole. Discussion: 20150629101108.GB17640@alap3.anarazel.de <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/07cb8b02ab4c8b65bb2e3b87ad2402fdc6cce978">http://git.postgresql.org/pg/commitdiff/07cb8b02ab4c8b65bb2e3b87ad2402fdc6cce978</a></li>

<li>Improve 9.5 release notes. 1) Add sgml comments referencing commits. This is useful to search for missing items etc. The comments containing the commit notes are an excerpt from: git log --date=short \ --pretty='format:%cd [%h] %&lt;(8,trunc)%cN: %&lt;(48,trunc)%s%n%n%w(,4,4)%b%n' \ $(git merge-base origin/master %upstream/REL9_4_STABLE)..origin/master 2) Improve a handful of %existing notes 3) Add missing entries about a couple features. 4) %Add a bunch of straight-forward FIXMEs %<a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c0b0501925eacbf2d9c10cd231bf8a14e7c9ef4c">http://git.postgresql.org/pg/commitdiff/c0b0501925eacbf2d9c10cd231bf8a14e7c9ef4c</a></li>

<li>Fix typo and omission in my earlier 9.5 release notes commit. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1561b541fd43b492ed9fe1b5c907bd88f54d1053">http://git.postgresql.org/pg/commitdiff/1561b541fd43b492ed9fe1b5c907bd88f54d1053</a></li>

</ul>

<p>Robert Haas pushed:</p>

<ul>

<li>In bttext_abbrev_convert, move pfree to the right place. Without this, we might access memory that's already been freed, or leak memory if in the C locale. Peter Geoghegan <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b48ecf862b3896631660ee8d38054aded82a4f8b">http://git.postgresql.org/pg/commitdiff/b48ecf862b3896631660ee8d38054aded82a4f8b</a></li>

</ul>

<p>&Atilde;lvaro Herrera pushed:</p>

<ul>

<li>Test -lrt for sched_yield. Apparently, this is needed in some Solaris versions. Author: Oskari Saarenmaa <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ab93f90cd3a4fcdd891cee9478941c3cc65795b8">http://git.postgresql.org/pg/commitdiff/ab93f90cd3a4fcdd891cee9478941c3cc65795b8</a></li>

</ul>

<p>Fujii Masao pushed:</p>

<ul>

<li>Make XLogFileCopy() look the same as in 9.4. XLogFileCopy() was changed heavily in commit de76884. However it was partially reverted in commit 7abc685 and most of those changes to XLogFileCopy() were no longer needed. Then commit 7cbee7c removed those unnecessary code, but XLogFileCopy() looked different in master and 9.4 though the contents are almost the same. This patch makes XLogFileCopy() look the same in master and back-branches, which makes back-patching easier, per discussion on pgsql-hackers. Back-patch to 9.5. Discussion: 55760844.7090703@iki.fi Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8217370864c950ea28c7f940442fe48c701461c2">http://git.postgresql.org/pg/commitdiff/8217370864c950ea28c7f940442fe48c701461c2</a></li>

<li>Make use of xlog_internal.h's macros in WAL-related utilities. Commit 179cdd09 added macros to check if a filename is a WAL segment or other such file. However there were still some instances of the strlen + strspn combination to check for that in WAL-related utilities like pg_archivecleanup. Those checks can be replaced with the macros. This patch makes use of the macros in those utilities and which would make the code a bit easier to read. Back-patch to 9.5. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fb174687f7a730edcf301949785a6ac0dbfd70d0">http://git.postgresql.org/pg/commitdiff/fb174687f7a730edcf301949785a6ac0dbfd70d0</a></li>

<li>Make WAL-related utilities handle .partial WAL files properly. Commit de76884 changed an archive recovery so that the last WAL segment with old timeline was renamed with suffix .partial. It should have updated WAL-related utilities so that they can handle such .paritial WAL files, but we forgot that. This patch changes pg_archivecleanup so that it can clean up even archived WAL files with .partial suffix. Also it allows us to specify .partial WAL file name as the command-line argument "oldestkeptwalfile". This patch also changes pg_resetxlog so that it can remove .partial WAL files in pg_xlog directory. pg_xlogdump cannot handle .partial WAL files. Per discussion, we decided only to document that limitation instead of adding the fix. Because a user can easily work around the limitation (i.e., just remove .partial suffix from the file name) and the fix seems complicated for very narrow use case. Back-patch to 9.5 where the problem existed. Review by Michael Paquier. Discussion: <a target="_blank" href="http://www.postgresql.org/message-id/CAHGQGwGxMKnVHGgTfiig2Bt_2djec0in3-DLJmtg7+nEiidFdQ@mail.gmail.com">http://www.postgresql.org/message-id/CAHGQGwGxMKnVHGgTfiig2Bt_2djec0in3-DLJmtg7+nEiidFdQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8650d161ae4369ec64a6fc7b7cbd0e6e55c3a7aa">http://git.postgresql.org/pg/commitdiff/8650d161ae4369ec64a6fc7b7cbd0e6e55c3a7aa</a></li>

<li>Remove incorrect warning from pg_archivecleanup document. The .backup file name can be passed to pg_archivecleanup even if it includes the extension which is specified in -x option. However, previously the document incorrectly warned a user not to do that. Back-patch to 9.2 where pg_archivecleanup's -x option and the warning were added. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/906e9249494bda975914b78fdd743609e1f83016">http://git.postgresql.org/pg/commitdiff/906e9249494bda975914b78fdd743609e1f83016</a></li>

</ul>

<p>Andrew Dunstan pushed:</p>

<ul>

<li>Allow MSVC's contribcheck and modulescheck to run independently. These require a temp install to have been done, so we now make sure it is done before proceeding. Michael Paquier. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d5d00294b05a54396f83db8abdf37c379a739794">http://git.postgresql.org/pg/commitdiff/d5d00294b05a54396f83db8abdf37c379a739794</a></li>

</ul>

<p>Joe Conway pushed:</p>

<ul>

<li>Whitespace fix - replace tab with spaces in CREATE TABLE command. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1fd0d5ec0373666fe00db4f641490d9e82f53e01">http://git.postgresql.org/pg/commitdiff/1fd0d5ec0373666fe00db4f641490d9e82f53e01</a></li>

<li>Make RLS related error messages more consistent and compliant. Also updated regression expected output to match. Noted and patch by Daniele Varrazzo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/02eac01f91923592f93abf8d325ab806b058f948">http://git.postgresql.org/pg/commitdiff/02eac01f91923592f93abf8d325ab806b058f948</a></li>

</ul>

<h2>Correctifs rejet&eacute;s (&agrave; ce jour)</h2>

<p>No one was disappointed this week :-)</p>

<h2>Correctifs en attente</h2>

<p>Amit Langote sent in a patch to adjust the errorcode for the error related to checking the flag bgw_flags in BackgroundWorkerInitializeConnection*() functions so that it matches the treatment in SanityCheckBackgroundWorker().</p>

<p>Jeff Janes sent in a patch to that implements the vm scan for truncation.</p>

<p>Michael Paquier and Heikki Linnakangas traded patches to fix some infelicities exposed by pg_rewind.</p>

<p>Amit Kapila sent in a patch to reduce ProcArrayLock contention by adding a mechanism to GroupClear the Xid during ProcArrayEndTransaction().</p>

<p>Jeff Janes sent in a patch to make a crash scenario he'd found easier to reproduce.</p>

<p>Franck Verrot sent in a patch to mention column name in error messages.</p>

<p>Peter Geoghegan sent in a patch to fix a bug in bttext_abbrev_convert().</p>

<p>Andres Freund sent in a patch to rework the way multixact truncations work.</p>

<p>Michael Paquier sent in a patch to add a couple of return value checks that were missing for JsonbIteratorNext in jsonfuncs.c.</p>

<p>Michael Paquier sent in a patch to add missing checks on return value of timestamp2tm in datetime.c.</p>

<p>Amit Kapila sent in a patch to extend pg_stat_activity to include wait_event.</p>

<p>Michael Paquier and Petr Jelinek traded fix a possible NULL pointer dereferernce in tablesample.c</p>

<p>Jeff Janes sent in another revision of a patch to update pg_trgm to use more modern facilities for a speed boost.</p>

<p>Michael Paquier sent in a patch to remove an unneeded NULL-pointer check in FreeSpaceMapTruncateRel.</p>

<p>Peter Eisentraut sent in a patch to allow the -X stream method to specify a replication slot and create it in the same run if needed.</p>

<p>Simon Riggs sent in a patch to reduce ClogControlLock contention at commit time.</p>

<p>Rahila Syed sent in a POC patch to allow tracking VACUUM progress.</p>

<p>Amit Kapila sent in two more revisions of a patch to rename mapfile if backupfile not present.</p>

<p>SAWADA Masahiko sent in three more revisions of a patch to add a "frozen" bit to the visibility map.</p>

<p>Kyotaro HORIGUCHI sent in another revision of a patch to allow asynchronous execution on a FDW.</p>

<p>Etsuro Fujita sent in a patch to fix an issue it's possible that the result of SELECT ... ORDER BY ... FOR UPDATE is not sorted correctly due to concurrent updates' having replaced the sort key columns with new values.</p>

<p>Robbie Harwood sent in a patch to add GSSAPI encryption support.</p>

<p>Amit Kapila sent in another revision of a patch to allow assessing parallel-safety.</p>

<p>Fabien COELHO sent in another revision of a patch to allow backslash-continuations in custom pgbench scripts.</p>

<p>Peter Geoghegan sent in a patch to make sorting text under a non-C locale faster than in 9.5.</p>

<p>Noah Misch sent in a patch to fix some strxfrm overflow bugs.</p>

<p>Michael Paquier sent in two revisions of a patch to fix an issue where table constraints and other objects were not being persisted over ALTERs.</p>

<p>Jan de Visser sent in another revision of a patch to let pg_ctl check the result of a postmaster config reload.</p>

<p>Amit Kapila sent in another revision of a patch to implement parallel seq scan.</p>

<p>Noah Misch sent in two revisions of a patch to implement xlc atomics.</p>

<p>Marco Atzeri sent in a patch to fix a 9.5alpha1 build failure with Perl 5.22.</p>

<p>Julien Rouhaud sent in a patch to allow using the PID of the backend in psql.</p>

<p>David Rowley sent in a patch to fix some infelicities in an as yet uncommitted memory accounting patch.</p>

<p>Joe Conway and Michael Paquier traded patches to add polymorphic functions to dblink.</p>

<p>Uriy Zhuravlev sent in another revision of a patch to enhance ALTER OPERATOR to allow setting some of the operator's parameters.</p>

<p>David Christensen sent in a patch to add \ddp to the tab completions in psql.</p>

<p>Pavel Stehule sent in another revision of a patch to allow raw output from COPY.</p>